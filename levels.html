<!DOCTYPE HTML>
<html>


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
<div id="topmenu">
    <button onclick="location.href='./index.html'" class="button_topmenu" id="button_project">Projet</button>
    <button onclick="location.href='./levels.html'" class="button_topmenu" id="button_level">Niveau</button>
    <button onclick="location.href='./tutos.html'" class="button_topmenu" id="button_tuto">Exemples</button>
    <button onclick="location.href='./creation.html'" class="button_topmenu" id="button_creation">Création</button>
</div>
<script> var mapn = 1; </script>
<script src="./maps.js"></script>
<script src="./declarations.js"></script>
<div id="levelmenu"></div>
<script>
    document.getElementById("button_project").innerHTML = PROJECT;
    document.getElementById("button_level").innerHTML = CHOOSE_LEVEL;
    document.getElementById("button_tuto").innerHTML = EXAMPLES;
    document.getElementById("button_creation").innerHTML = CREATION;
    var lmenu = document.getElementById("levelmenu");
    for(var level=1; level<=map_level.length; level++){
        lmenu.innerHTML += "<button class='level_button' onclick=level_click(this)>" +
                            LEVEL + " " + level.toString() + "</button>"
    }
    lmenu.innerHTML += "<button class='level_button' onclick=load_user_level() id='ulevel_button'>" +
                        USER_LEVEL + "</button>"
    function level_click(e){
        var level = e.innerHTML.split(" ")[1].trim();
        location.href='./play.html?mapn=' + level;
    }
    function get_user_levels_data(){
        var result = null;
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", "usermaps.js", false);
        xmlhttp.send();
        if (xmlhttp.status == 200) {
            result = xmlhttp.responseText;
        }
        return result;
    }
    function get_n_user_levels(){
        var data = get_user_levels_data();
        var maps = data.split("\n");
        var mapstrs = []
        for(var i=0; i<maps.length; i++)
            if(maps[i].length > 8)
                mapstrs.push(maps[i]);
        return mapstrs.length;
    }
    var data_level;
    function load_user_level(){
        if(!document.getElementById("form_ulevel")){
            var s = '<div id="form_ulevel"><form onsubmit="parse_user_level(this.value);">' +
              '<label for="level">Choisis le numéro du niveau : </label>'+
              '<select id="level">';
            for(var i=0; i<get_n_user_levels(); i++){
                s += '<option value="' + i.toString() + '">' + i.toString() +'</option>';
            }
              s += "</select>"+ '<input type="submit"> </form></div>';
            document.getElementById("levelmenu").innerHTML += s;
        }
    }
    function parse_user_level(n){
        n = parseInt(n);
        data_level = get_user_levels_data();
        alert("***" + n.toString());
        alert(data_level.length);
        var maps = data_level.split("\n");
        var mapstrs = []
        for(var i=0; i<maps.length; i++)
            if(maps[i].length > 2)
                mapstrs.push(maps[i]);
        alert(mapstrs.length);
        alert(mapstrs);
        alert(mapstrs[n]);
        location.href='./play.html?mapn=USER' + mapstrs[0];
    }
</script>
<div class="footer">
    (C) 2020 Yann Thorimbert<br>
    Contact : <a href="mailto:yann.thorimbert@gmail.com">Yann.Thorimbert@gmail.com</a>
</div>
</body>

</html>
